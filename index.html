<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Russo Money Transfer - Calculadora</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Calculadora de transferencias con gesti√≥n de cr√©ditos">
    <meta name="theme-color" content="#4CAF50">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Russo Transfer">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect fill='%234CAF50' width='200' height='200'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='100' fill='white'%3Eüí∞%3C/text%3E%3C/svg%3E">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .tasas-header {
            background: #1a1a1a;
            border: 2px solid #4CAF50;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .tasa-item {
            display: flex;
            flex-direction: column;
        }

        .tasa-item label {
            color: #888;
            font-size: 11px;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .tasa-item input {
            width: 100%;
            padding: 10px;
            background: #0a0a0a;
            border: 2px solid #333;
            border-radius: 6px;
            color: #4CAF50;
            font-size: 16px;
            font-weight: 700;
            text-align: center;
        }

        .tasa-item input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab:hover {
            border-color: #4CAF50;
        }

        .tab.active {
            background: #4CAF50;
            border-color: #4CAF50;
            color: #000;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .calculator {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 16px;
            border: 1px solid #333;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: #888;
            margin-bottom: 8px;
            font-size: 13px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 14px;
            background: #0a0a0a;
            border: 2px solid #333;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 16px;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .results {
            margin-top: 30px;
            padding: 20px 0;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #222;
        }

        .result-label {
            color: #888;
            font-size: 13px;
        }

        .result-value {
            color: #e0e0e0;
            font-size: 18px;
            font-weight: 600;
        }

        .result-value.commission {
            color: #FF9800;
        }

        .result-value.highlight {
            color: #4CAF50;
            font-size: 24px;
        }

        .result-value.payout {
            color: #2196F3;
            font-size: 32px;
        }

        .btn-save {
            width: 100%;
            padding: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }

        .btn-save:hover {
            background: #45a049;
        }

        .btn-clear {
            width: 100%;
            padding: 14px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .btn-clear:hover {
            background: #d32f2f;
        }

        .btn-clear-data {
            width: 100%;
            padding: 12px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        .btn-clear-data:hover {
            background: #d32f2f;
        }

        .btn-toggle-tasas {
            padding: 12px 24px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-toggle-tasas:hover {
            background: #1976D2;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            overflow-y: auto;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #1a1a1a;
            margin: 50px auto;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            border: 1px solid #333;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #888;
        }

        .close-modal:hover {
            color: #fff;
        }

        .modal h2 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        /* Reportes */
        .report-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 30px;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .report-header h2 {
            color: #4CAF50;
            font-size: 24px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .date-filter input {
            padding: 10px;
            background: #0a0a0a;
            border: 2px solid #333;
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
        }

        .stat-label {
            color: #888;
            font-size: 13px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .stat-value {
            color: #4CAF50;
            font-size: 32px;
            font-weight: 700;
        }

        .transactions-list {
            margin-top: 20px;
        }

        .transaction-item {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-date {
            color: #888;
            font-size: 12px;
        }

        .transaction-country {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            margin: 5px 0;
        }

        .transaction-amount {
            color: #2196F3;
            font-size: 14px;
        }

        .transaction-profit {
            color: #4CAF50;
            font-size: 20px;
            font-weight: 700;
            text-align: right;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        @media (max-width: 600px) {
            .result-value.payout {
                font-size: 24px;
            }
        }

        /* Animaci√≥n de d√≥lares */
        .money-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .dollar {
            position: absolute;
            font-size: 40px;
            animation: fall 3s linear forwards;
            opacity: 0;
        }

        @keyframes fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color: #4CAF50; text-align: center; margin-bottom: 20px; font-size: 28px;">üí∞ Russo Money Transfer</h1>

        <!-- BOT√ìN TOGGLE TASAS -->
        <div style="text-align: center; margin-bottom: 15px;">
            <button class="btn-toggle-tasas" onclick="toggleTasas()">
                <span id="toggleIcon">üëÅÔ∏è</span> <span id="toggleText">Ver Tasas</span>
            </button>
        </div>

        <!-- HEADER CON TASAS -->
        <div class="tasas-header" id="tasasHeader" style="display: none;">
            <div class="tasa-item">
                <label>Tasa Venezuela (Bs)</label>
                <input type="number" id="tasaVenezuela" step="0.01" value="0" onchange="guardarTasas()">
            </div>
            <div class="tasa-item">
                <label>Tasa Colombia (COP)</label>
                <input type="number" id="tasaColombia" step="0.01" value="0" onchange="guardarTasas()">
            </div>
            <div class="tasa-item">
                <label>Tasa Rep. Dom. (DOP)</label>
                <input type="number" id="tasaDominicana" step="0.01" value="0" onchange="guardarTasas()">
            </div>
        </div>

        <!-- PESTA√ëAS -->
        <div class="tabs">
            <div class="tab active" onclick="cambiarPesta√±a('calculadora')">Calculadora</div>
            <div class="tab" onclick="cambiarPesta√±a('reporte')">Reporte</div>
            <div class="tab" onclick="cambiarPesta√±a('rentabilidad')">Rentabilidad</div>
        </div>

        <!-- PESTA√ëA CALCULADORA -->
        <div id="calculadora" class="tab-content active">
            <div class="calculator">
                <!-- INPUTS -->
                <div class="input-group">
                    <label>Pa√≠s</label>
                    <select id="pais">
                        <option value="">Seleccionar pa√≠s...</option>
                        <option value="Venezuela">Venezuela</option>
                        <option value="Colombia">Colombia</option>
                        <option value="Rep√∫blica Dominicana">Rep√∫blica Dominicana</option>
                        <option value="Otro">Otro (USD a USD)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Monto Recibido (ANG)</label>
                    <input type="number" id="montoANG" placeholder="0.00" step="0.01" min="0">
                </div>

                <!-- CALCULADORA INVERSA -->
                <div style="text-align: center; margin: 20px 0;">
                    <div style="color: #888; font-size: 12px; margin-bottom: 10px;">O CALCULA AL REV√âS ‚¨áÔ∏è</div>
                </div>

                <div class="input-group">
                    <label>El cliente quiere recibir (en su moneda local)</label>
                    <input type="number" id="montoRecibir" placeholder="Ej: 30000" step="0.01" min="0" oninput="calcularInverso()">
                </div>

                <div class="input-group" id="montoDebePayarGroup" style="display: none;">
                    <label>üíµ El cliente debe pagar</label>
                    <input type="text" id="montoDebePagar" readonly style="background: #1a3a1a; color: #4CAF50; font-size: 20px; font-weight: 700; text-align: center;">
                </div>

                <!-- RESULTADOS -->
                <div class="results">
                    <div class="result-item">
                        <div class="result-label">Pa√≠s Seleccionado</div>
                        <div class="result-value" id="paisMostrar">-</div>
                    </div>

                    <div class="result-item">
                        <div class="result-label">Monto Recibido</div>
                        <div class="result-value"><span id="montoMostrar">0.00</span> ANG</div>
                    </div>

                    <div class="result-item">
                        <div class="result-label">Equivalente en USD</div>
                        <div class="result-value">$<span id="usdMostrar">0.00</span> USD</div>
                    </div>

                    <div class="result-item">
                        <div class="result-label">Comisi√≥n (10%)</div>
                        <div class="result-value commission">$<span id="comisionMostrar">0.00</span> USD</div>
                    </div>

                    <div class="result-item">
                        <div class="result-label">Lo que me queda</div>
                        <div class="result-value highlight">$<span id="quedaMostrar">0.00</span> USD</div>
                    </div>

                    <div class="result-item">
                        <div class="result-label">Total que recibe el cliente</div>
                        <div class="result-value payout"><span id="totalCliente">0.00</span> <span id="monedaCliente"></span></div>
                    </div>
                </div>

                <button class="btn-save" onclick="mostrarOpcionesPago()">üíæ Guardar Transacci√≥n</button>
                <button class="btn-clear" onclick="limpiar()">üîÑ Limpiar</button>
            </div>
        </div>

        <!-- PESTA√ëA REPORTE -->
        <div id="reporte" class="tab-content">
            <div class="report-section">
                <div class="report-header">
                    <h2>üìä Reportes</h2>
                    <div class="date-filter">
                        <input type="date" id="fechaInicio">
                        <input type="date" id="fechaFin">
                        <button class="btn-save" style="margin: 0; padding: 10px 20px; width: auto;" onclick="filtrarReporte()">Filtrar</button>
                    </div>
                </div>

                <!-- ESTAD√çSTICAS -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Ganancia Hoy (USD)</div>
                        <div class="stat-value">$<span id="gananciaHoy">0.00</span></div>
                        <div style="color: #888; font-size: 14px; margin-top: 5px;"><span id="gananciaHoyANG">0.00</span> ANG</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Transferencias Hoy</div>
                        <div class="stat-value" style="color: #2196F3;"><span id="transferenciasHoy">0</span></div>
                        <div style="color: #888; font-size: 14px; margin-top: 5px;">del d√≠a de hoy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ganancia Este Mes (USD)</div>
                        <div class="stat-value">$<span id="gananciaMes">0.00</span></div>
                        <div style="color: #888; font-size: 14px; margin-top: 5px;"><span id="gananciaMesANG">0.00</span> ANG</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Cr√©ditos Pendientes</div>
                        <div class="stat-value" style="color: #FF9800;"><span id="creditosPendientes">0</span></div>
                        <div style="color: #888; font-size: 14px; margin-top: 5px;">üí∞ <span id="montoCreditosANG">0.00</span> ANG</div>
                    </div>
                </div>

                <!-- LISTA DE TRANSACCIONES -->
                <h3 style="color: #4CAF50; margin-bottom: 15px;">Historial</h3>
                <div class="transactions-list" id="transaccionesList"></div>

                <button class="btn-clear-data" onclick="borrarTodo()">üóëÔ∏è Borrar Todos los Datos</button>
            </div>
        </div>

        <!-- PESTA√ëA RENTABILIDAD -->
        <div id="rentabilidad" class="tab-content">
            <div class="report-section">
                <h2 style="color: #4CAF50; margin-bottom: 20px;">üìà Rentabilidad por D√≠a</h2>
                
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-label">Mejor D√≠a del Mes</div>
                        <div class="stat-value" style="color: #4CAF50;">$<span id="mejorDia">0.00</span></div>
                        <div style="color: #888; font-size: 14px; margin-top: 5px;"><span id="fechaMejorDia">-</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Promedio Diario</div>
                        <div class="stat-value">$<span id="promedioDiario">0.00</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total del Mes</div>
                        <div class="stat-value" style="color: #2196F3;">$<span id="totalMes">0.00</span></div>
                    </div>
                </div>

                <h3 style="color: #4CAF50; margin-bottom: 15px;">Desglose Diario</h3>
                <div id="rentabilidadDiaria"></div>
            </div>
        </div>
    </div>

    <!-- Modal Opciones de Pago -->
    <div class="modal" id="opcionesPagoModal">
        <div class="modal-content">
            <span class="close-modal" onclick="cerrarModalPago()">&times;</span>
            <h2>üí∞ ¬øC√≥mo se pag√≥ esta transacci√≥n?</h2>
            
            <div class="btn-group" style="margin-top: 20px; flex-direction: column;">
                <button class="btn btn-primary" onclick="guardarTransaccion('pagada')" style="width: 100%; margin-bottom: 10px; padding: 16px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer;">
                    ‚úÖ PAGADA (Cliente pag√≥)
                </button>
                <button class="btn" onclick="mostrarFormularioCredito()" style="width: 100%; background: #FF9800; color: white; padding: 16px; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer;">
                    üí≥ CR√âDITO (Cliente debe pagar)
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Formulario de Cr√©dito -->
    <div class="modal" id="creditoModal">
        <div class="modal-content">
            <span class="close-modal" onclick="cerrarModalCredito()">&times;</span>
            <h2>üí≥ Datos del Cr√©dito</h2>
            
            <div class="form-group" style="margin-top: 20px;">
                <label style="display: block; color: #888; margin-bottom: 8px; font-size: 13px;">Nombre del Cliente *</label>
                <input type="text" id="nombreClienteCredito" placeholder="Nombre completo" style="width: 100%; padding: 14px; background: #0a0a0a; border: 2px solid #333; border-radius: 8px; color: #e0e0e0; font-size: 16px;">
            </div>

            <div class="form-group" style="margin-top: 20px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="aplicarInteresCredito" onchange="actualizarMontoCredito()">
                    <span style="color: #e0e0e0;">Aplicar 10% adicional por cr√©dito</span>
                </label>
            </div>

            <div class="form-group" id="montoConInteresGroup" style="display: none; margin-top: 20px;">
                <label style="display: block; color: #888; margin-bottom: 8px; font-size: 13px;">üíµ Monto Total a Cobrar (con 10% adicional)</label>
                <input type="text" id="montoTotalCredito" readonly style="width: 100%; padding: 14px; background: #1a3a1a; color: #FF9800; font-size: 20px; font-weight: 700; text-align: center; border: 2px solid #333; border-radius: 8px;">
            </div>

            <div class="btn-group" style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="guardarTransaccion('credito')" style="flex: 1; padding: 16px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer;">üíæ Guardar Cr√©dito</button>
                <button class="btn btn-secondary" onclick="cerrarModalCredito()" style="flex: 1; padding: 16px; background: #666; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer;">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // CONSTANTES FIJAS
        const COMMISSION_RATE = 0.10;
        const USD_TO_ANG = 1.82;

        // FUNCI√ìN ANIMACI√ìN DE D√ìLARES
        function mostrarAnimacionDolares() {
            const container = document.createElement('div');
            container.className = 'money-animation';
            document.body.appendChild(container);

            // Crear 30 d√≥lares cayendo
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const dollar = document.createElement('div');
                    dollar.className = 'dollar';
                    dollar.textContent = 'üíµ';
                    dollar.style.left = Math.random() * 100 + '%';
                    dollar.style.animationDelay = '0s';
                    dollar.style.animationDuration = (2 + Math.random() * 2) + 's';
                    container.appendChild(dollar);

                    // Remover despu√©s de la animaci√≥n
                    setTimeout(() => {
                        dollar.remove();
                    }, 4000);
                }, i * 100);
            }

            // Remover contenedor despu√©s de 5 segundos
            setTimeout(() => {
                container.remove();
            }, 5000);
        }

        // TASAS POR PA√çS
        let tasas = {
            'Venezuela': 0,
            'Colombia': 0,
            'Rep√∫blica Dominicana': 0,
            'Otro': 1.0  // USD a USD = 1:1
        };

        // MONEDAS POR PA√çS
        const monedas = {
            'Venezuela': 'Bs',
            'Colombia': 'COP',
            'Rep√∫blica Dominicana': 'DOP',
            'Otro': 'USD'
        };

        // ELEMENTOS
        const paisSelect = document.getElementById('pais');
        const montoInput = document.getElementById('montoANG');
        const paisMostrar = document.getElementById('paisMostrar');
        const montoMostrar = document.getElementById('montoMostrar');
        const usdMostrar = document.getElementById('usdMostrar');
        const comisionMostrar = document.getElementById('comisionMostrar');
        const quedaMostrar = document.getElementById('quedaMostrar');
        const totalCliente = document.getElementById('totalCliente');
        const monedaCliente = document.getElementById('monedaCliente');

        // TRANSACCIONES
        let transacciones = JSON.parse(localStorage.getItem('russoTransacciones')) || [];

        // CARGAR TASAS GUARDADAS
        function cargarTasas() {
            const tasasGuardadas = localStorage.getItem('russoTasas');
            if (tasasGuardadas) {
                tasas = JSON.parse(tasasGuardadas);
            }
            
            // "Otro" siempre tiene tasa fija 1.0 (USD a USD)
            tasas['Otro'] = 1.0;
            
            document.getElementById('tasaVenezuela').value = tasas['Venezuela'] || 0;
            document.getElementById('tasaColombia').value = tasas['Colombia'] || 0;
            document.getElementById('tasaDominicana').value = tasas['Rep√∫blica Dominicana'] || 0;
        }

        // GUARDAR TASAS
        function guardarTasas() {
            tasas['Venezuela'] = parseFloat(document.getElementById('tasaVenezuela').value) || 0;
            tasas['Colombia'] = parseFloat(document.getElementById('tasaColombia').value) || 0;
            tasas['Rep√∫blica Dominicana'] = parseFloat(document.getElementById('tasaDominicana').value) || 0;
            tasas['Otro'] = 1.0; // Siempre fijo (USD a USD)
            
            localStorage.setItem('russoTasas', JSON.stringify(tasas));
            calcular();
        }

        // TOGGLE TASAS
        function toggleTasas() {
            const tasasHeader = document.getElementById('tasasHeader');
            const toggleIcon = document.getElementById('toggleIcon');
            const toggleText = document.getElementById('toggleText');
            
            if (tasasHeader.style.display === 'none') {
                tasasHeader.style.display = 'grid';
                toggleIcon.textContent = 'üôà';
                toggleText.textContent = 'Ocultar Tasas';
            } else {
                tasasHeader.style.display = 'none';
                toggleIcon.textContent = 'üëÅÔ∏è';
                toggleText.textContent = 'Ver Tasas';
            }
        }

        // EVENTOS
        paisSelect.addEventListener('change', calcular);
        montoInput.addEventListener('input', calcular);

        // FUNCI√ìN CAMBIAR PESTA√ëA
        function cambiarPesta√±a(pesta√±a) {
            // Ocultar todas las pesta√±as
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Mostrar la pesta√±a seleccionada
            document.getElementById(pesta√±a).classList.add('active');
            event.target.classList.add('active');

            // Si es reporte, actualizar datos
            if (pesta√±a === 'reporte') {
                actualizarReporte();
            }
            
            // Si es rentabilidad, generar reporte
            if (pesta√±a === 'rentabilidad') {
                generarRentabilidad();
            }
        }

        // FUNCI√ìN DE C√ÅLCULO
        function calcular() {
            const pais = paisSelect.value;
            const montoANG = parseFloat(montoInput.value) || 0;

            // Limpiar calculadora inversa cuando se usa la normal
            if (montoANG > 0) {
                document.getElementById('montoRecibir').value = '';
                document.getElementById('montoDebePayarGroup').style.display = 'none';
            }

            // Actualizar pa√≠s
            paisMostrar.textContent = pais || '-';

            // Si el monto es 0 o vac√≠o, mostrar todo en 0
            if (montoANG <= 0 || !pais) {
                montoMostrar.textContent = '0.00';
                usdMostrar.textContent = '0.00';
                comisionMostrar.textContent = '0.00';
                quedaMostrar.textContent = '0.00';
                totalCliente.textContent = '0.00';
                monedaCliente.textContent = '';
                return;
            }

            // CONVERSI√ìN ANG ‚Üí USD
            const montoUSD = montoANG / USD_TO_ANG;

            // C√ÅLCULO
            const comisionUSD = montoUSD * COMMISSION_RATE;
            const meQuedaUSD = montoUSD - comisionUSD;
            
            // CALCULAR TOTAL CLIENTE SEG√öN TASA DEL PA√çS
            const tasaPais = tasas[pais] || 0;
            const totalClienteCalc = meQuedaUSD * tasaPais;
            const monedaPais = monedas[pais] || '';

            // MOSTRAR RESULTADOS
            montoMostrar.textContent = montoANG.toFixed(2);
            usdMostrar.textContent = montoUSD.toFixed(2);
            comisionMostrar.textContent = comisionUSD.toFixed(2);
            quedaMostrar.textContent = meQuedaUSD.toFixed(2);
            
            // MOSTRAR TOTAL CLIENTE (aunque sea 0, mostrar el pa√≠s)
            if (tasaPais > 0) {
                totalCliente.textContent = totalClienteCalc.toFixed(2);
                monedaCliente.textContent = monedaPais;
            } else {
                totalCliente.textContent = '0.00';
                monedaCliente.textContent = monedaPais + ' (‚ö†Ô∏è Configura la tasa)';
            }
        }

        // FUNCI√ìN LIMPIAR
        function limpiar() {
            paisSelect.value = '';
            montoInput.value = '';
            document.getElementById('montoRecibir').value = '';
            document.getElementById('montoDebePayarGroup').style.display = 'none';
            paisMostrar.textContent = '-';
            montoMostrar.textContent = '0.00';
            usdMostrar.textContent = '0.00';
            comisionMostrar.textContent = '0.00';
            quedaMostrar.textContent = '0.00';
            totalCliente.textContent = '0.00';
            monedaCliente.textContent = '';
        }

        // FUNCI√ìN CALCULAR INVERSO
        function calcularInverso() {
            const pais = paisSelect.value;
            const montoRecibir = parseFloat(document.getElementById('montoRecibir').value) || 0;

            // Limpiar campo normal cuando se usa inverso
            if (montoRecibir > 0) {
                montoInput.value = '';
            }

            if (!pais || montoRecibir <= 0) {
                document.getElementById('montoDebePayarGroup').style.display = 'none';
                return;
            }

            const tasaPais = tasas[pais] || 0;
            
            if (tasaPais <= 0) {
                alert('‚ö†Ô∏è Por favor configura la tasa para ' + pais);
                document.getElementById('montoDebePayarGroup').style.display = 'none';
                return;
            }

            // C√ÅLCULO INVERSO:
            const meQuedaUSD = montoRecibir / tasaPais;
            const montoUSD = meQuedaUSD / 0.90;
            const montoANG = montoUSD * USD_TO_ANG;

            // Mostrar resultado
            const monedaPais = monedas[pais] || '';
            document.getElementById('montoDebePagar').value = `${montoANG.toFixed(2)} ANG (${montoUSD.toFixed(2)} USD)`;
            document.getElementById('montoDebePayarGroup').style.display = 'block';
        }

        // FUNCI√ìN GUARDAR TRANSACCI√ìN
        function mostrarOpcionesPago() {
            const pais = paisSelect.value;
            const montoANG = parseFloat(montoInput.value) || 0;

            if (!pais || montoANG <= 0) {
                alert('‚ö†Ô∏è Selecciona un pa√≠s e ingresa un monto v√°lido');
                return;
            }

            // Mostrar modal de opciones
            document.getElementById('opcionesPagoModal').style.display = 'flex';
        }

        function cerrarModalPago() {
            document.getElementById('opcionesPagoModal').style.display = 'none';
        }

        function mostrarFormularioCredito() {
            document.getElementById('opcionesPagoModal').style.display = 'none';
            document.getElementById('creditoModal').style.display = 'flex';
            actualizarMontoCredito();
        }

        function cerrarModalCredito() {
            document.getElementById('creditoModal').style.display = 'none';
            document.getElementById('nombreClienteCredito').value = '';
            document.getElementById('aplicarInteresCredito').checked = false;
            document.getElementById('montoConInteresGroup').style.display = 'none';
        }

        function actualizarMontoCredito() {
            const aplicarInteres = document.getElementById('aplicarInteresCredito').checked;
            const montoANG = parseFloat(montoInput.value) || 0;
            
            if (aplicarInteres) {
                const montoConInteres = montoANG * 1.10;
                const montoUSDConInteres = montoConInteres / USD_TO_ANG;
                document.getElementById('montoTotalCredito').value = `${montoConInteres.toFixed(2)} ANG (${montoUSDConInteres.toFixed(2)} USD)`;
                document.getElementById('montoConInteresGroup').style.display = 'block';
            } else {
                document.getElementById('montoConInteresGroup').style.display = 'none';
            }
        }

        function guardarTransaccion(tipoPago) {
            const pais = paisSelect.value;
            const montoANG = parseFloat(montoInput.value) || 0;

            if (!pais || montoANG <= 0) {
                alert('‚ö†Ô∏è Datos incompletos');
                return;
            }

            const montoUSD = montoANG / USD_TO_ANG;
            const comisionUSD = montoUSD * COMMISSION_RATE;
            const ganancia = comisionUSD;
            const meQuedaUSD = montoUSD - comisionUSD;
            const tasaPais = tasas[pais] || 0;
            const totalClienteCalc = meQuedaUSD * tasaPais;

            // Datos espec√≠ficos de cr√©dito
            let esCredito = tipoPago === 'credito';
            let nombreCliente = '';
            let montoACobrar = montoANG;
            let aplicoInteres = false;

            if (esCredito) {
                nombreCliente = document.getElementById('nombreClienteCredito').value.trim();
                
                if (!nombreCliente) {
                    alert('‚ö†Ô∏è Ingresa el nombre del cliente para el cr√©dito');
                    return;
                }

                aplicoInteres = document.getElementById('aplicarInteresCredito').checked;
                if (aplicoInteres) {
                    montoACobrar = montoANG * 1.10;
                }
            }

            const transaccion = {
                id: Date.now(),
                fecha: new Date().toISOString(),
                pais: pais,
                montoANG: montoANG,
                montoUSD: montoUSD,
                comision: comisionUSD,
                ganancia: ganancia,
                meQueda: meQuedaUSD,
                tasa: tasaPais,
                totalCliente: totalClienteCalc,
                moneda: monedas[pais],
                tipoPago: tipoPago,
                esCredito: esCredito,
                nombreCliente: nombreCliente,
                montoACobrar: montoACobrar,
                aplicoInteres: aplicoInteres,
                pagado: !esCredito
            };

            transacciones.push(transaccion);
            localStorage.setItem('russoTransacciones', JSON.stringify(transacciones));

            // Cerrar modales
            cerrarModalPago();
            cerrarModalCredito();

            // MOSTRAR ANIMACI√ìN DE D√ìLARES
            mostrarAnimacionDolares();

            if (esCredito) {
                alert(`‚úÖ Cr√©dito registrado para: ${nombreCliente}\nüíµ Monto a cobrar: ${montoACobrar.toFixed(2)} ANG`);
            } else {
                alert('‚úÖ Transacci√≥n guardada como PAGADA');
            }
            
            limpiar();
        }

        // FUNCI√ìN ACTUALIZAR REPORTE
        function actualizarReporte() {
            const hoy = new Date();
            const inicioHoy = new Date(hoy.getFullYear(), hoy.getMonth(), hoy.getDate());
            const inicioMes = new Date(hoy.getFullYear(), hoy.getMonth(), 1);

            // Filtrar transacciones
            const transaccionesHoy = transacciones.filter(t => new Date(t.fecha) >= inicioHoy);
            const transaccionesMes = transacciones.filter(t => new Date(t.fecha) >= inicioMes);

            // Calcular ganancias en USD
            const gananciaHoy = transaccionesHoy.reduce((sum, t) => sum + t.ganancia, 0);
            const gananciaMes = transaccionesMes.reduce((sum, t) => sum + t.ganancia, 0);

            // Convertir a ANG
            const gananciaHoyANG = gananciaHoy * USD_TO_ANG;
            const gananciaMesANG = gananciaMes * USD_TO_ANG;

            // Calcular cr√©ditos pendientes (TODOS, sin filtro de fecha)
            const creditosPendientes = transacciones.filter(t => t.esCredito && !t.pagado);
            const montoCreditosANG = creditosPendientes.reduce((sum, t) => sum + (t.montoACobrar || t.montoANG), 0);

            // Actualizar estad√≠sticas
            document.getElementById('gananciaHoy').textContent = gananciaHoy.toFixed(2);
            document.getElementById('gananciaHoyANG').textContent = gananciaHoyANG.toFixed(2);
            document.getElementById('transferenciasHoy').textContent = transaccionesHoy.length;
            document.getElementById('gananciaMes').textContent = gananciaMes.toFixed(2);
            document.getElementById('gananciaMesANG').textContent = gananciaMesANG.toFixed(2);
            document.getElementById('creditosPendientes').textContent = creditosPendientes.length;
            document.getElementById('montoCreditosANG').textContent = montoCreditosANG.toFixed(2);

            // MOSTRAR SOLO: Transacciones de HOY + Cr√©ditos pendientes (de cualquier fecha)
            const transaccionesParaMostrar = transacciones.filter(t => {
                const esDeHoy = new Date(t.fecha) >= inicioHoy;
                const esCreditoPendiente = t.esCredito && !t.pagado;
                
                // Mostrar si es de hoy O si es cr√©dito pendiente
                return esDeHoy || esCreditoPendiente;
            });

            mostrarTransacciones(transaccionesParaMostrar);
        }

        // FUNCI√ìN MOSTRAR TRANSACCIONES
        function mostrarTransacciones(lista) {
            const container = document.getElementById('transaccionesList');

            if (lista.length === 0) {
                container.innerHTML = '<div class="no-data">No hay transacciones registradas</div>';
                return;
            }

            // Ordenar por fecha descendente
            const ordenadas = [...lista].sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

            container.innerHTML = ordenadas.map(t => {
                const fecha = new Date(t.fecha);
                const fechaStr = fecha.toLocaleDateString('es-ES') + ' ' + fecha.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'});
                const gananciaANG = t.ganancia * USD_TO_ANG;
                
                // Mostrar estado de cr√©dito
                let estadoPago = '';
                let botonPagar = '';
                
                if (t.esCredito && !t.pagado) {
                    // Cr√©dito PENDIENTE - NOMBRE M√ÅS GRANDE
                    estadoPago = `<div style="color: #FF9800; font-size: 18px; font-weight: 700; margin: 5px 0;">üí≥ ${t.nombreCliente}</div>`;
                    estadoPago += `<div style="color: #FF9800; font-size: 12px; font-weight: 600;">CR√âDITO PENDIENTE</div>`;
                    if (t.aplicoInteres) {
                        estadoPago += `<div style="color: #FF9800; font-size: 11px;">A cobrar: ${t.montoACobrar.toFixed(2)} ANG (con 10%)</div>`;
                    } else {
                        estadoPago += `<div style="color: #FF9800; font-size: 11px;">A cobrar: ${t.montoACobrar.toFixed(2)} ANG</div>`;
                    }
                    // Bot√≥n para marcar como pagado
                    botonPagar = `<button onclick="marcarComoPagado(${t.id})" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 5px; font-size: 11px; font-weight: 600;">‚úÖ MARCAR PAGADO</button>`;
                } else if (t.esCredito && t.pagado) {
                    // Cr√©dito YA PAGADO
                    estadoPago = `<div style="color: #4CAF50; font-size: 16px; font-weight: 700; margin: 5px 0;">‚úÖ ${t.nombreCliente}</div>`;
                    estadoPago += `<div style="color: #4CAF50; font-size: 12px; font-weight: 600;">CR√âDITO PAGADO</div>`;
                    if (t.aplicoInteres) {
                        estadoPago += `<div style="color: #888; font-size: 11px;">Cobrado: ${t.montoACobrar.toFixed(2)} ANG (con 10%)</div>`;
                    } else {
                        estadoPago += `<div style="color: #888; font-size: 11px;">Cobrado: ${t.montoACobrar.toFixed(2)} ANG</div>`;
                    }
                } else {
                    // Transacci√≥n normal PAGADA
                    estadoPago = `<div style="color: #4CAF50; font-size: 12px; font-weight: 600;">‚úÖ PAGADA</div>`;
                }

                return `
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-date">${fechaStr}</div>
                            <div class="transaction-country">${t.pais}</div>
                            ${estadoPago}
                            ${botonPagar}
                            <div class="transaction-amount">${t.montoANG.toFixed(2)} ANG ‚Üí ${t.totalCliente.toFixed(2)} ${t.moneda}</div>
                        </div>
                        <div class="transaction-profit">
                            <div>+$${t.ganancia.toFixed(2)}</div>
                            <div style="font-size: 14px; color: #888;">${gananciaANG.toFixed(2)} ANG</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // FUNCI√ìN FILTRAR REPORTE
        function filtrarReporte() {
            const fechaInicio = document.getElementById('fechaInicio').value;
            const fechaFin = document.getElementById('fechaFin').value;

            if (!fechaInicio || !fechaFin) {
                alert('‚ö†Ô∏è Selecciona ambas fechas');
                return;
            }

            const inicio = new Date(fechaInicio);
            const fin = new Date(fechaFin);
            fin.setHours(23, 59, 59, 999);

            const filtradas = transacciones.filter(t => {
                const fecha = new Date(t.fecha);
                return fecha >= inicio && fecha <= fin;
            });

            const gananciaFiltrada = filtradas.reduce((sum, t) => sum + t.ganancia, 0);
            const gananciaFiltradaANG = gananciaFiltrada * USD_TO_ANG;
            
            // Actualizar solo el total de transacciones y mostrar lista filtrada
            document.getElementById('totalTransacciones').textContent = filtradas.length;
            mostrarTransacciones(filtradas);
            
            alert(`üìä Ganancia en per√≠odo seleccionado:\nüíµ $${gananciaFiltrada.toFixed(2)} USD\nüíµ ${gananciaFiltradaANG.toFixed(2)} ANG`);
        }

        // FUNCI√ìN BORRAR TODO
        function borrarTodo() {
            if (!confirm('‚ö†Ô∏è ¬øEst√°s seguro de borrar TODAS las transacciones? Esta acci√≥n no se puede deshacer.')) {
                return;
            }

            transacciones = [];
            localStorage.removeItem('russoTransacciones');
            actualizarReporte();
            alert('‚úÖ Todos los datos han sido borrados');
        }

        // FUNCI√ìN MARCAR CR√âDITO COMO PAGADO
        function marcarComoPagado(id) {
            const transaccion = transacciones.find(t => t.id === id);
            
            if (!transaccion) {
                alert('‚ö†Ô∏è Transacci√≥n no encontrada');
                return;
            }

            if (confirm(`¬øMarcar como PAGADO el cr√©dito de ${transaccion.nombreCliente}?\nüíµ Monto: ${transaccion.montoACobrar.toFixed(2)} ANG`)) {
                transaccion.pagado = true;
                localStorage.setItem('russoTransacciones', JSON.stringify(transacciones));
                
                // MOSTRAR ANIMACI√ìN DE D√ìLARES
                mostrarAnimacionDolares();
                
                actualizarReporte();
                alert('‚úÖ Cr√©dito marcado como PAGADO');
            }
        }

        // FUNCI√ìN GENERAR RENTABILIDAD
        function generarRentabilidad() {
            // Agrupar transacciones por d√≠a
            const gananciasPorDia = {};
            
            transacciones.forEach(t => {
                const fecha = new Date(t.fecha);
                const diaKey = fecha.toISOString().split('T')[0]; // YYYY-MM-DD
                
                if (!gananciasPorDia[diaKey]) {
                    gananciasPorDia[diaKey] = {
                        fecha: diaKey,
                        gananciaUSD: 0,
                        gananciaANG: 0,
                        transacciones: [],
                        cantidad: 0
                    };
                }
                
                gananciasPorDia[diaKey].gananciaUSD += t.ganancia;
                gananciasPorDia[diaKey].gananciaANG += t.ganancia * USD_TO_ANG;
                gananciasPorDia[diaKey].transacciones.push(t);
                gananciasPorDia[diaKey].cantidad += 1;
            });

            // Convertir a array y ordenar por fecha descendente
            const diasArray = Object.values(gananciasPorDia).sort((a, b) => 
                new Date(b.fecha) - new Date(a.fecha)
            );

            // Calcular estad√≠sticas
            const totalMes = diasArray.reduce((sum, d) => sum + d.gananciaUSD, 0);
            const promedioDiario = diasArray.length > 0 ? totalMes / diasArray.length : 0;
            const mejorDiaObj = diasArray.length > 0 ? diasArray.reduce((max, d) => 
                d.gananciaUSD > max.gananciaUSD ? d : max
            ) : null;

            // Actualizar estad√≠sticas
            document.getElementById('totalMes').textContent = totalMes.toFixed(2);
            document.getElementById('promedioDiario').textContent = promedioDiario.toFixed(2);
            
            if (mejorDiaObj) {
                document.getElementById('mejorDia').textContent = mejorDiaObj.gananciaUSD.toFixed(2);
                const fechaFormateada = new Date(mejorDiaObj.fecha).toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                document.getElementById('fechaMejorDia').textContent = fechaFormateada;
            } else {
                document.getElementById('mejorDia').textContent = '0.00';
                document.getElementById('fechaMejorDia').textContent = '-';
            }

            // Mostrar desglose diario
            const container = document.getElementById('rentabilidadDiaria');
            
            if (diasArray.length === 0) {
                container.innerHTML = '<div class="no-data">No hay datos de rentabilidad</div>';
                return;
            }

            container.innerHTML = diasArray.map((dia, index) => {
                const fecha = new Date(dia.fecha);
                const fechaStr = fecha.toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                // Generar HTML del detalle de transacciones
                const detalleTransacciones = dia.transacciones.map(t => {
                    const hora = new Date(t.fecha).toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'});
                    const gananciaANG = t.ganancia * USD_TO_ANG;
                    
                    return `
                        <div style="padding: 10px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="color: #888; font-size: 11px;">${hora}</div>
                                <div style="color: #fff; font-size: 14px; font-weight: 600;">${t.pais}</div>
                                <div style="color: #2196F3; font-size: 12px;">${t.montoANG.toFixed(2)} ANG ‚Üí ${t.totalCliente.toFixed(2)} ${t.moneda}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #4CAF50; font-size: 16px; font-weight: 700;">+$${t.ganancia.toFixed(2)}</div>
                                <div style="color: #888; font-size: 11px;">${gananciaANG.toFixed(2)} ANG</div>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div style="margin-bottom: 10px;">
                        <div class="transaction-item" onclick="toggleDetalleDia('detalle-${index}')" style="background: #0a0a0a; cursor: pointer;">
                            <div class="transaction-info">
                                <div class="transaction-date" style="font-size: 14px; font-weight: 600;">${fechaStr}</div>
                                <div style="color: #888; font-size: 12px; margin-top: 5px;">${dia.cantidad} transacci√≥n${dia.cantidad > 1 ? 'es' : ''} ‚Ä¢ Haz clic para ver detalle</div>
                            </div>
                            <div class="transaction-profit">
                                <div style="color: #4CAF50; font-size: 20px;">+$${dia.gananciaUSD.toFixed(2)}</div>
                                <div style="font-size: 14px; color: #888;">${dia.gananciaANG.toFixed(2)} ANG</div>
                            </div>
                        </div>
                        <div id="detalle-${index}" style="display: none; background: #1a1a1a; border-radius: 8px; margin-top: 5px; overflow: hidden;">
                            ${detalleTransacciones}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // FUNCI√ìN PARA EXPANDIR/CONTRAER DETALLE DEL D√çA
        function toggleDetalleDia(id) {
            const detalle = document.getElementById(id);
            if (detalle.style.display === 'none') {
                detalle.style.display = 'block';
            } else {
                detalle.style.display = 'none';
            }
        }

        // Inicializar
        window.onload = function() {
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fechaInicio').value = hoy;
            document.getElementById('fechaFin').value = hoy;
            cargarTasas();
            
            // Registrar Service Worker para PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registrado:', registration);
                    })
                    .catch(error => {
                        console.log('Error al registrar Service Worker:', error);
                    });
            }
        };
    </script>
</body>
</html>
